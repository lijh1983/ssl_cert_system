import{c as e,I as re,d as ie,a as C,p as Y,S as E,C as ee,q as de,E as N,o as ce,b as w,e as o,f as d,w as t,s as $,n as Z,h as _,l as p,k as h,D as fe,F as ae,t as se,v as D,x as g,y as te,z as K,A as ne,r as _e,B as U,m as B,G as M,H as pe,P as ve,R as me,i as ge}from"./index-BA-staGq.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as ye}from"./RealTimeChart-4ZIL4nvy.js";var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};function oe(f){for(var l=1;l<arguments.length;l++){var s=arguments[l]!=null?Object(arguments[l]):{},u=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(s).filter(function(v){return Object.getOwnPropertyDescriptor(s,v).enumerable}))),u.forEach(function(v){ke(f,v,s[v])})}return f}function ke(f,l,s){return l in f?Object.defineProperty(f,l,{value:s,enumerable:!0,configurable:!0,writable:!0}):f[l]=s,f}var V=function(l,s){var u=oe({},l,s.attrs);return e(re,oe({},u,{icon:he}),null)};V.displayName="ArrowDownOutlined";V.inheritAttrs=!1;var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};function le(f){for(var l=1;l<arguments.length;l++){var s=arguments[l]!=null?Object(arguments[l]):{},u=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(s).filter(function(v){return Object.getOwnPropertyDescriptor(s,v).enumerable}))),u.forEach(function(v){we(f,v,s[v])})}return f}function we(f,l,s){return l in f?Object.defineProperty(f,l,{value:s,enumerable:!0,configurable:!0,writable:!0}):f[l]=s,f}var G=function(l,s){var u=le({},l,s.attrs);return e(re,le({},u,{icon:be}),null)};G.displayName="ArrowUpOutlined";G.inheritAttrs=!1;const xe={class:"data-statistics"},Ce={class:"stats-header"},Oe={class:"stats-controls"},Se={class:"stats-content"},$e={class:"stat-icon"},Pe={class:"stat-content"},De={class:"stat-value"},ze={class:"stat-label"},Re={key:0,class:"stat-change"},Ie={class:"change-period"},je={key:0,class:"trend-charts"},Le={class:"chart-container"},Ae={class:"mini-chart"},Te={width:"100%",height:"120",viewBox:"0 0 400 120"},Ue=["points"],Be={class:"chart-container"},Me={class:"pie-chart"},Ee={class:"pie-label"},Ne={class:"pie-value"},Ve={key:1,class:"detailed-data"},Ge=ie({__name:"DataStatistics",setup(f){const l=C(null),s=C("overview"),u=C(!1),v=[{key:"total_certificates",label:"证书总数",value:156,icon:E,color:"#1890ff",change:12,changePeriod:"较上月",trend:"up"},{key:"active_servers",label:"活跃服务器",value:24,icon:ee,color:"#52c41a",change:5,changePeriod:"较上月",trend:"up"},{key:"success_rate",label:"成功率",value:"98.5%",icon:de,color:"#52c41a",change:2.1,changePeriod:"较上月",trend:"up"},{key:"pending_tasks",label:"待处理任务",value:3,icon:N,color:"#faad14",change:-15,changePeriod:"较上月",trend:"down"}],A=[{key:"new_certificates",label:"新申请证书",value:23,icon:E,color:"#1890ff",change:18,changePeriod:"较上周",trend:"up"},{key:"renewed_certificates",label:"续期证书",value:45,icon:E,color:"#52c41a",change:8,changePeriod:"较上周",trend:"up"},{key:"expiring_soon",label:"即将过期",value:7,icon:N,color:"#faad14",change:-12,changePeriod:"较上周",trend:"down"},{key:"failed_operations",label:"操作失败",value:2,icon:N,color:"#ff4d4f",change:-50,changePeriod:"较上周",trend:"down"}],T=Y(()=>{switch(s.value){case"certificates":return A;case"servers":return v.filter(i=>i.key.includes("server"));case"operations":return v.filter(i=>i.key.includes("rate")||i.key.includes("tasks"));default:return v}}),H=Y(()=>s.value==="overview"||s.value==="certificates"),q=Y(()=>s.value!=="overview"),F=C([20,25,18,32,28,35,23,29,31,27]),z=C([{name:"在线",value:18,color:"#52c41a"},{name:"离线",value:3,color:"#ff4d4f"},{name:"维护中",value:3,color:"#faad14"}]),J=[{title:"项目",dataIndex:"name",key:"name"},{title:"数量",dataIndex:"count",key:"count"},{title:"状态",dataIndex:"status",key:"status"},{title:"趋势",dataIndex:"trend",key:"trend"}],Q=C([{name:"Let's Encrypt 证书",count:120,status:"正常",trend:15},{name:"自签名证书",count:36,status:"正常",trend:-5},{name:"Ubuntu 服务器",count:15,status:"正常",trend:8},{name:"CentOS 服务器",count:9,status:"正常",trend:12}]),W=i=>i.map((R,I)=>{const j=20+I/(i.length-1)*360,P=100-(R-Math.min(...i))/(Math.max(...i)-Math.min(...i))*(120-2*20);return`${j},${P}`}).join(" "),r=i=>({正常:"green",警告:"orange",错误:"red"})[i]||"default",n=()=>{y()},x=()=>{y()},y=async()=>{u.value=!0;try{await new Promise(i=>setTimeout(i,500)),Z.success({title:"数据已更新",description:"统计数据已刷新到最新状态"})}catch{Z.error({title:"加载失败",description:"无法加载统计数据"})}finally{u.value=!1}},k=()=>{const i={type:s.value,dateRange:l.value,stats:T.value,exportTime:new Date().toISOString()},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),O=URL.createObjectURL(a),b=document.createElement("a");b.href=O,b.download=`statistics-${s.value}-${new Date().toISOString().split("T")[0]}.json`,b.click(),URL.revokeObjectURL(O),Z.success({title:"导出成功",description:"统计数据已导出到本地文件"})};return ce(()=>{y()}),(i,a)=>{const O=d("a-range-picker"),b=d("a-select-option"),R=d("a-select"),I=d("a-button"),j=d("a-space"),P=d("a-col"),m=d("a-row"),S=d("a-tag"),X=d("a-table");return _(),w("div",xe,[o("div",Ce,[a[7]||(a[7]=o("h4",null,"数据统计",-1)),o("div",Oe,[e(j,null,{default:t(()=>[e(O,{value:l.value,"onUpdate:value":a[0]||(a[0]=c=>l.value=c),size:"small",onChange:n},null,8,["value"]),e(R,{value:s.value,"onUpdate:value":a[1]||(a[1]=c=>s.value=c),size:"small",onChange:x},{default:t(()=>[e(b,{value:"overview"},{default:t(()=>a[2]||(a[2]=[p("概览")])),_:1,__:[2]}),e(b,{value:"certificates"},{default:t(()=>a[3]||(a[3]=[p("证书")])),_:1,__:[3]}),e(b,{value:"servers"},{default:t(()=>a[4]||(a[4]=[p("服务器")])),_:1,__:[4]}),e(b,{value:"operations"},{default:t(()=>a[5]||(a[5]=[p("操作")])),_:1,__:[5]})]),_:1},8,["value"]),e(I,{size:"small",onClick:k},{icon:t(()=>[e(h(fe))]),default:t(()=>[a[6]||(a[6]=p(" 导出 "))]),_:1,__:[6]})]),_:1})])]),o("div",Se,[e(m,{gutter:[16,16]},{default:t(()=>[(_(!0),w(ae,null,se(T.value,c=>(_(),D(P,{xs:24,sm:12,md:6,key:c.key},{default:t(()=>[o("div",{class:te(["stat-card",c.trend])},[o("div",$e,[(_(),D(K(c.icon),{style:ne({color:c.color})},null,8,["style"]))]),o("div",Pe,[o("div",De,g(c.value),1),o("div",ze,g(c.label),1),c.change?(_(),w("div",Re,[(_(),D(K(c.change>0?h(G):h(V)))),o("span",null,g(Math.abs(c.change))+"%",1),o("span",Ie,g(c.changePeriod),1)])):$("",!0)])],2)]),_:2},1024))),128))]),_:1}),H.value?(_(),w("div",je,[e(m,{gutter:[16,16]},{default:t(()=>[e(P,{xs:24,md:12},{default:t(()=>[o("div",Le,[a[9]||(a[9]=o("h5",null,"证书申请趋势",-1)),o("div",Ae,[(_(),w("svg",Te,[a[8]||(a[8]=o("defs",null,[o("linearGradient",{id:"certificateGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[o("stop",{offset:"0%",style:{"stop-color":"#1890ff","stop-opacity":"0.3"}}),o("stop",{offset:"100%",style:{"stop-color":"#1890ff","stop-opacity":"0"}})])],-1)),o("polyline",{points:W(F.value),fill:"url(#certificateGradient)",stroke:"#1890ff","stroke-width":"2"},null,8,Ue)]))])])]),_:1}),e(P,{xs:24,md:12},{default:t(()=>[o("div",Be,[a[10]||(a[10]=o("h5",null,"服务器状态分布",-1)),o("div",Me,[(_(!0),w(ae,null,se(z.value,c=>(_(),w("div",{class:"pie-item",key:c.name},[o("div",{class:"pie-color",style:ne({backgroundColor:c.color})},null,4),o("span",Ee,g(c.name),1),o("span",Ne,g(c.value),1)]))),128))])])]),_:1})]),_:1})])):$("",!0),q.value?(_(),w("div",Ve,[e(X,{columns:J,"data-source":Q.value,pagination:{pageSize:10},size:"small"},{bodyCell:t(({column:c,record:L})=>[c.key==="status"?(_(),D(S,{key:0,color:r(L.status)},{default:t(()=>[p(g(L.status),1)]),_:2},1032,["color"])):$("",!0),c.key==="trend"?(_(),w("span",{key:1,class:te(L.trend>0?"trend-up":"trend-down")},[(_(),D(K(L.trend>0?h(G):h(V)))),p(" "+g(Math.abs(L.trend))+"% ",1)],2)):$("",!0)]),_:1},8,["data-source"])])):$("",!0)])])}}}),He=ue(Ge,[["__scopeId","data-v-27b264d6"]]),qe={class:"home-container"},Fe={class:"table-footer"},Je={class:"chart-placeholder"},Qe={class:"table-footer"},We=ie({__name:"Home",setup(f){const l=ge(),s=C(!1),u=_e({totalCertificates:0,expiringSoon:0,expired:0,onlineServers:0}),v=C([]),A=C([]),T=[{title:"域名",dataIndex:"domain",key:"domain"},{title:"颁发者",dataIndex:"issuer",key:"issuer"},{title:"状态",dataIndex:"status",key:"status"},{title:"剩余天数",dataIndex:"days_remaining",key:"days_remaining"},{title:"操作",key:"actions"}],H=r=>({issued:"green",pending:"blue",expired:"red",error:"red",revoked:"orange"})[r]||"default",q=r=>({issued:"已签发",pending:"待处理",expired:"已过期",error:"错误",revoked:"已撤销"})[r]||r,F=r=>r<=0?"text-danger":r<=7?"text-warning":r<=30?"text-info":"text-success",z=async()=>{s.value=!0;try{const[r,n,x]=await Promise.all([U.get("/monitors/stats"),U.get("/certificates?limit=5"),U.get("/servers?limit=5")]);r.success&&Object.assign(u,r.data),n.success&&(v.value=n.data.certificates||n.data.items||[]),x.success&&(A.value=x.data.servers||x.data.items||[])}catch(r){console.error("加载数据失败:",r),B.error("加载数据失败")}finally{s.value=!1}},J=()=>{z(),B.success("数据已刷新")},Q=r=>{l.push(`/certificates/${r.id}`)},W=async r=>{try{await U.post(`/certificates/${r.id}/renew`),B.success("证书续期请求已提交"),z()}catch{B.error("证书续期失败")}};return ce(()=>{z()}),(r,n)=>{const x=d("a-statistic"),y=d("a-card"),k=d("a-col"),i=d("a-row"),a=d("a-button"),O=d("a-tag"),b=d("a-space"),R=d("a-table"),I=d("a-list-item-meta"),j=d("a-list-item"),P=d("a-list");return _(),w("div",qe,[e(i,{gutter:[16,16],class:"overview-cards"},{default:t(()=>[e(k,{xs:24,sm:12,md:6},{default:t(()=>[e(y,null,{default:t(()=>[e(x,{title:"证书总数",value:u.totalCertificates,prefix:M(h(E),{style:{color:"#1890ff"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(k,{xs:24,sm:12,md:6},{default:t(()=>[e(y,null,{default:t(()=>[e(x,{title:"即将过期",value:u.expiringSoon,prefix:M(h(N),{style:{color:"#faad14"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(k,{xs:24,sm:12,md:6},{default:t(()=>[e(y,null,{default:t(()=>[e(x,{title:"已过期",value:u.expired,prefix:M(h(pe),{style:{color:"#ff4d4f"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(k,{xs:24,sm:12,md:6},{default:t(()=>[e(y,null,{default:t(()=>[e(x,{title:"在线服务器",value:u.onlineServers,prefix:M(h(ee),{style:{color:"#52c41a"}})},null,8,["value","prefix"])]),_:1})]),_:1})]),_:1}),e(y,{title:"快速操作",class:"quick-actions"},{default:t(()=>[e(i,{gutter:[16,16]},{default:t(()=>[e(k,{xs:24,sm:12,md:8},{default:t(()=>[e(a,{type:"primary",size:"large",block:"",onClick:n[0]||(n[0]=m=>r.$router.push("/certificates/new"))},{icon:t(()=>[e(h(ve))]),default:t(()=>[n[4]||(n[4]=p(" 申请新证书 "))]),_:1,__:[4]})]),_:1}),e(k,{xs:24,sm:12,md:8},{default:t(()=>[e(a,{size:"large",block:"",onClick:n[1]||(n[1]=m=>r.$router.push("/servers/new"))},{icon:t(()=>[e(h(ee))]),default:t(()=>[n[5]||(n[5]=p(" 添加服务器 "))]),_:1,__:[5]})]),_:1}),e(k,{xs:24,sm:12,md:8},{default:t(()=>[e(a,{size:"large",block:"",onClick:J},{icon:t(()=>[e(h(me))]),default:t(()=>[n[6]||(n[6]=p(" 刷新数据 "))]),_:1,__:[6]})]),_:1})]),_:1})]),_:1}),e(y,{title:"最近证书",class:"recent-certificates"},{default:t(()=>[e(R,{columns:T,"data-source":v.value,pagination:!1,loading:s.value,size:"small"},{bodyCell:t(({column:m,record:S})=>[m.key==="status"?(_(),D(O,{key:0,color:H(S.status)},{default:t(()=>[p(g(q(S.status)),1)]),_:2},1032,["color"])):$("",!0),m.key==="days_remaining"?(_(),w("span",{key:1,class:te(F(S.days_remaining))},g(S.days_remaining)+"天 ",3)):$("",!0),m.key==="actions"?(_(),D(b,{key:2},{default:t(()=>[e(a,{type:"link",size:"small",onClick:X=>Q(S)},{default:t(()=>n[7]||(n[7]=[p(" 查看 ")])),_:2,__:[7]},1032,["onClick"]),e(a,{type:"link",size:"small",onClick:X=>W(S)},{default:t(()=>n[8]||(n[8]=[p(" 续期 ")])),_:2,__:[8]},1032,["onClick"])]),_:2},1024)):$("",!0)]),_:1},8,["data-source","loading"]),o("div",Fe,[e(a,{type:"link",onClick:n[2]||(n[2]=m=>r.$router.push("/certificates"))},{default:t(()=>n[9]||(n[9]=[p(" 查看所有证书 → ")])),_:1,__:[9]})])]),_:1}),e(He,{class:"statistics-section"}),e(i,{gutter:[16,16]},{default:t(()=>[e(k,{xs:24,md:12},{default:t(()=>[e(y,{title:"证书状态分布",class:"chart-card"},{default:t(()=>[o("div",Je,[e(ye,{title:"证书健康度",type:"certificates","auto-refresh":!0})])]),_:1})]),_:1}),e(k,{xs:24,md:12},{default:t(()=>[e(y,{title:"服务器状态",class:"server-status"},{default:t(()=>[e(P,{"data-source":A.value,loading:s.value,size:"small"},{renderItem:t(({item:m})=>[e(j,null,{default:t(()=>[e(I,null,{title:t(()=>[o("span",null,g(m.hostname),1),e(O,{color:m.status==="online"?"green":"red",class:"status-tag"},{default:t(()=>[p(g(m.status==="online"?"在线":"离线"),1)]),_:2},1032,["color"])]),description:t(()=>[p(g(m.ip_address)+" | "+g(m.os_type),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source","loading"]),o("div",Qe,[e(a,{type:"link",onClick:n[3]||(n[3]=m=>r.$router.push("/servers"))},{default:t(()=>n[10]||(n[10]=[p(" 查看所有服务器 → ")])),_:1,__:[10]})])]),_:1})]),_:1})]),_:1})])}}}),Ke=ue(We,[["__scopeId","data-v-bfe536c8"]]);export{Ke as default};
