import{c as t,I as R,d as fe,a as C,p as _e,j as me,o as ve,b as A,e as l,v as w,w as a,f as m,s as N,B as S,h as g,l as c,k as v,K as pe,x as _,R as ge,L as ye,D as H,q as be,M as we,N as Oe,y as ke,F as xe,t as Ce,O as Se,S as De,i as $e,n as E,m as b}from"./index-BA-staGq.js";import{L as Le,A as J}from"./ActionFeedback-C8mGXM-p.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};function Q(i){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?Object(arguments[o]):{},u=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(r).filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable}))),u.forEach(function(d){je(i,d,r[d])})}return i}function je(i,o,r){return o in i?Object.defineProperty(i,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[o]=r,i}var T=function(o,r){var u=Q({},o,r.attrs);return t(R,Q({},u,{icon:he}),null)};T.displayName="KeyOutlined";T.inheritAttrs=!1;var Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function W(i){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?Object(arguments[o]):{},u=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(r).filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable}))),u.forEach(function(d){ze(i,d,r[d])})}return i}function ze(i,o,r){return o in i?Object.defineProperty(i,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[o]=r,i}var I=function(o,r){var u=W({},o,r.attrs);return t(R,W({},u,{icon:Ae}),null)};I.displayName="LinkOutlined";I.inheritAttrs=!1;var Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function X(i){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?Object(arguments[o]):{},u=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(r).filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable}))),u.forEach(function(d){Me(i,d,r[d])})}return i}function Me(i,o,r){return o in i?Object.defineProperty(i,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[o]=r,i}var F=function(o,r){var u=X({},o,r.attrs);return t(R,X({},u,{icon:Be}),null)};F.displayName="SyncOutlined";F.inheritAttrs=!1;const Ne={class:"certificate-detail-container"},Ee={class:"page-header"},Re={style:{margin:"0"}},Te={key:1,class:"certificate-content"},Ie={class:"info-item"},Fe={class:"value"},Ve={class:"info-item"},qe={class:"value"},Ue={class:"info-item"},Ze={class:"value"},Ge={class:"info-item"},He={class:"value"},Je={class:"info-item"},Qe={class:"value"},We={class:"info-item"},Xe={class:"value"},Ye={class:"domain-section"},Ke={key:0,class:"domain-section"},et={class:"alt-domains"},tt={class:"info-item"},at={class:"value"},nt={class:"info-item"},lt={class:"value"},st={class:"info-item"},ot={class:"value"},rt={class:"info-item"},it={class:"value"},ut={class:"validity-progress"},dt={class:"progress-info"},ct={class:"note-content"},ft=fe({__name:"CertificateDetail",setup(i){const o=me(),r=$e(),u=C(!1),d=C(!1),z=C(!1),s=C(null),O=C(""),k=_e(()=>o.params.id),V=n=>({issued:"green",pending:"blue",expired:"red",error:"red",revoked:"orange"})[n]||"default",q=n=>({issued:"已签发",pending:"待处理",expired:"已过期",error:"错误",revoked:"已撤销"})[n]||n,Y=n=>n<=0?"text-danger":n<=7?"text-warning":n<=30?"text-info":"text-success",D=n=>n?new Date(n).toLocaleString("zh-CN"):"-",K=n=>n?n.split(",").map(e=>e.trim()).filter(Boolean):[],B=()=>{if(!s.value)return 0;const n=new Date(s.value.valid_to).getTime()-new Date(s.value.valid_from).getTime(),e=Date.now()-new Date(s.value.valid_from).getTime();return Math.min(100,Math.max(0,e/n*100))},ee=()=>{const n=B();return n>=90?"exception":n>=70?"active":"normal"},te=()=>{const n=B();return n>=90?"#ff4d4f":n>=70?"#faad14":"#52c41a"},ae=()=>s.value?Math.ceil((new Date(s.value.valid_to).getTime()-new Date(s.value.valid_from).getTime())/(1e3*60*60*24))-s.value.days_remaining:0,$=async()=>{u.value=!0,O.value="";try{const n=await S.get(`/certificates/${k.value}`);n.success?s.value=n.data.certificate||n.data:O.value=n.message||"加载证书详情失败"}catch(n){O.value=n.message||"网络错误",console.error("加载证书详情失败:",n)}finally{u.value=!1}},M=()=>{r.back()},ne=()=>{$(),E.success({title:"数据已刷新",description:"证书详情信息已更新到最新状态"})},le=async()=>{var n,e;d.value=!0;try{await S.post(`/certificates/${k.value}/renew`),E.certificateRenewed(((n=s.value)==null?void 0:n.domain)||"证书"),$()}catch(p){E.operationError("续期",`证书 ${(e=s.value)==null?void 0:e.domain}`,p.message)}finally{d.value=!1}},se=async n=>{z.value=!0;try{await S.put(`/certificates/${k.value}`,{auto_renew:n}),s.value.auto_renew=n,b.success(`自动续期已${n?"开启":"关闭"}`)}catch{b.error("更新自动续期设置失败")}finally{z.value=!1}},L=async n=>{try{await S.download(`/certificates/${k.value}/download/${n}`),b.success("文件下载成功")}catch{b.error("文件下载失败")}},U=async()=>{try{await S.download(`/certificates/${k.value}/download`,`${s.value.domain}.zip`),b.success("证书文件下载成功")}catch{b.error("证书文件下载失败")}},oe=({key:n})=>{switch(n){case"download":U();break;case"verify":b.info("域名验证功能开发中");break;case"edit":b.info("编辑配置功能开发中");break;case"delete":b.info("删除证书功能开发中");break}};return ve(()=>{$()}),(n,e)=>{const p=m("a-button"),Z=m("a-divider"),P=m("a-tag"),G=m("a-space"),f=m("a-col"),h=m("a-menu-item"),re=m("a-menu-divider"),ie=m("a-menu"),ue=m("a-dropdown"),j=m("a-row"),de=m("a-switch"),x=m("a-card"),ce=m("a-progress");return g(),A("div",Ne,[l("div",Ee,[t(j,{justify:"space-between",align:"middle"},{default:a(()=>[t(f,null,{default:a(()=>[t(G,null,{default:a(()=>{var y;return[t(p,{onClick:M,type:"text"},{icon:a(()=>[t(v(pe))]),default:a(()=>[e[4]||(e[4]=c(" 返回 "))]),_:1,__:[4]}),t(Z,{type:"vertical"}),l("h2",Re,_(((y=s.value)==null?void 0:y.domain)||"证书详情"),1),s.value?(g(),w(P,{key:0,color:V(s.value.status)},{default:a(()=>[c(_(q(s.value.status)),1)]),_:1},8,["color"])):N("",!0)]}),_:1})]),_:1}),t(f,null,{default:a(()=>[t(G,null,{default:a(()=>[t(p,{onClick:ne},{icon:a(()=>[t(v(ge))]),default:a(()=>[e[5]||(e[5]=c(" 刷新 "))]),_:1,__:[5]}),t(p,{type:"primary",onClick:le,loading:d.value},{icon:a(()=>[t(v(F))]),default:a(()=>[e[6]||(e[6]=c(" 续期证书 "))]),_:1,__:[6]},8,["loading"]),t(ue,null,{overlay:a(()=>[t(ie,{onClick:oe},{default:a(()=>[t(h,{key:"download"},{default:a(()=>[t(v(H)),e[8]||(e[8]=c(" 下载证书 "))]),_:1,__:[8]}),t(h,{key:"verify"},{default:a(()=>[t(v(be)),e[9]||(e[9]=c(" 验证域名 "))]),_:1,__:[9]}),t(h,{key:"edit"},{default:a(()=>[t(v(we)),e[10]||(e[10]=c(" 编辑配置 "))]),_:1,__:[10]}),t(re),t(h,{key:"delete",danger:""},{default:a(()=>[t(v(Oe)),e[11]||(e[11]=c(" 删除证书 "))]),_:1,__:[11]})]),_:1})]),default:a(()=>[t(p,null,{default:a(()=>[e[7]||(e[7]=c(" 更多操作 ")),t(v(ye))]),_:1,__:[7]})]),_:1})]),_:1})]),_:1})]),_:1})]),u.value?(g(),w(Le,{key:0,text:"加载证书详情中...",description:"正在获取证书的详细信息，请稍候"})):s.value?(g(),A("div",Te,[t(x,{title:"基本信息",class:"info-card"},{default:a(()=>[t(j,{gutter:[24,16]},{default:a(()=>[t(f,{xs:24,sm:12,md:8},{default:a(()=>[l("div",Ie,[e[12]||(e[12]=l("label",null,"主域名",-1)),l("div",Fe,_(s.value.domain),1)])]),_:1}),t(f,{xs:24,sm:12,md:8},{default:a(()=>[l("div",Ve,[e[13]||(e[13]=l("label",null,"证书状态",-1)),l("div",qe,[t(P,{color:V(s.value.status)},{default:a(()=>[c(_(q(s.value.status)),1)]),_:1},8,["color"])])])]),_:1}),t(f,{xs:24,sm:12,md:8},{default:a(()=>[l("div",Ue,[e[14]||(e[14]=l("label",null,"剩余天数",-1)),l("div",Ze,[l("span",{class:ke(Y(s.value.days_remaining))},_(s.value.days_remaining)+"天 ",3)])])]),_:1}),t(f,{xs:24,sm:12,md:8},{default:a(()=>[l("div",Ge,[e[15]||(e[15]=l("label",null,"颁发者",-1)),l("div",He,_(s.value.issuer||"Let's Encrypt"),1)])]),_:1}),t(f,{xs:24,sm:12,md:8},{default:a(()=>[l("div",Je,[e[16]||(e[16]=l("label",null,"加密类型",-1)),l("div",Qe,_(s.value.encryption_type||"ECC"),1)])]),_:1}),t(f,{xs:24,sm:12,md:8},{default:a(()=>[l("div",We,[e[17]||(e[17]=l("label",null,"自动续期",-1)),l("div",Xe,[t(de,{checked:s.value.auto_renew,onChange:se,loading:z.value},null,8,["checked","loading"])])])]),_:1})]),_:1})]),_:1}),t(x,{title:"域名信息",class:"info-card"},{default:a(()=>[l("div",Ye,[e[18]||(e[18]=l("h4",null,"主域名",-1)),t(P,{color:"blue",class:"domain-tag"},{default:a(()=>[c(_(s.value.domain),1)]),_:1})]),s.value.alt_domains?(g(),A("div",Ke,[e[19]||(e[19]=l("h4",null,"备用域名",-1)),l("div",et,[(g(!0),A(xe,null,Ce(K(s.value.alt_domains),y=>(g(),w(P,{key:y,class:"domain-tag"},{default:a(()=>[c(_(y),1)]),_:2},1024))),128))])])):N("",!0)]),_:1}),t(x,{title:"有效期信息",class:"info-card"},{default:a(()=>[t(j,{gutter:[24,16]},{default:a(()=>[t(f,{xs:24,sm:12},{default:a(()=>[l("div",tt,[e[20]||(e[20]=l("label",null,"生效时间",-1)),l("div",at,_(D(s.value.valid_from)),1)])]),_:1}),t(f,{xs:24,sm:12},{default:a(()=>[l("div",nt,[e[21]||(e[21]=l("label",null,"过期时间",-1)),l("div",lt,_(D(s.value.valid_to)),1)])]),_:1}),t(f,{xs:24,sm:12},{default:a(()=>[l("div",st,[e[22]||(e[22]=l("label",null,"创建时间",-1)),l("div",ot,_(D(s.value.created_at)),1)])]),_:1}),t(f,{xs:24,sm:12},{default:a(()=>[l("div",rt,[e[23]||(e[23]=l("label",null,"更新时间",-1)),l("div",it,_(D(s.value.updated_at)),1)])]),_:1})]),_:1}),l("div",ut,[e[24]||(e[24]=l("h4",null,"有效期进度",-1)),t(ce,{percent:B(),status:ee(),"stroke-color":te()},null,8,["percent","status","stroke-color"]),l("div",dt,[l("span",null,"已使用 "+_(ae())+" 天",1),l("span",null,"剩余 "+_(s.value.days_remaining)+" 天",1)])])]),_:1}),t(x,{title:"证书文件",class:"info-card"},{default:a(()=>[t(j,{gutter:[16,16]},{default:a(()=>[t(f,{xs:24,sm:12,md:6},{default:a(()=>[t(p,{block:"",onClick:e[0]||(e[0]=y=>L("cert"))},{icon:a(()=>[t(v(Se))]),default:a(()=>[e[25]||(e[25]=c(" 证书文件 (.crt) "))]),_:1,__:[25]})]),_:1}),t(f,{xs:24,sm:12,md:6},{default:a(()=>[t(p,{block:"",onClick:e[1]||(e[1]=y=>L("key"))},{icon:a(()=>[t(v(T))]),default:a(()=>[e[26]||(e[26]=c(" 私钥文件 (.key) "))]),_:1,__:[26]})]),_:1}),t(f,{xs:24,sm:12,md:6},{default:a(()=>[t(p,{block:"",onClick:e[2]||(e[2]=y=>L("ca"))},{icon:a(()=>[t(v(De))]),default:a(()=>[e[27]||(e[27]=c(" CA证书 (.ca) "))]),_:1,__:[27]})]),_:1}),t(f,{xs:24,sm:12,md:6},{default:a(()=>[t(p,{block:"",onClick:e[3]||(e[3]=y=>L("fullchain"))},{icon:a(()=>[t(v(I))]),default:a(()=>[e[28]||(e[28]=c(" 完整链 (.pem) "))]),_:1,__:[28]})]),_:1})]),_:1}),t(Z),t(p,{type:"primary",block:"",onClick:U},{icon:a(()=>[t(v(H))]),default:a(()=>[e[29]||(e[29]=c(" 下载所有文件 (ZIP) "))]),_:1,__:[29]})]),_:1}),s.value.note?(g(),w(x,{key:0,title:"备注信息",class:"info-card"},{default:a(()=>[l("div",ct,_(s.value.note),1)]),_:1})):N("",!0)])):O.value?(g(),w(J,{key:2,type:"error",title:"加载失败",description:O.value,"primary-action":{text:"重试",handler:$},"secondary-action":{text:"返回列表",handler:M}},null,8,["description","primary-action","secondary-action"])):(g(),w(J,{key:3,type:"404",title:"证书不存在",description:"请检查证书ID是否正确，或者该证书可能已被删除","primary-action":{text:"返回列表",handler:M}},null,8,["primary-action"]))])}}}),pt=Pe(ft,[["__scopeId","data-v-6fa19ec9"]]);export{pt as default};
