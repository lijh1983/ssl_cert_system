import{d as le,a as x,r as N,o as ne,b as c,c as t,w as a,f as r,B as S,m as i,h as _,e as C,k as O,J as re,l,s as k,v as P,F as L,x as f,P as ue,R as de}from"./index-BA-staGq.js";import{E as ie}from"./EmptyState-Bc6z0PfQ.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"servers-container"},ve={class:"search-section"},me={class:"server-info"},fe={key:2},ye={class:"text-muted"},ge={key:0},be={key:1,class:"text-muted"},ce=le({__name:"Servers",setup(ke){const I=x(!1),U=x(!1),y=x(!1),R=x([]),B=x(),g=N({keyword:"",status:void 0}),n=N({hostname:"",ip_address:"",os_type:"",os_version:"",web_server:"",web_server_version:"",auto_deploy:!1}),v=N({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条记录`}),W=[{title:"主机名",dataIndex:"hostname",key:"hostname"},{title:"状态",dataIndex:"status",key:"status"},{title:"系统信息",key:"system_info"},{title:"自动部署",dataIndex:"auto_deploy",key:"auto_deploy"},{title:"最后心跳",dataIndex:"last_heartbeat",key:"last_heartbeat",sorter:!0},{title:"操作",key:"actions",width:180}],q={hostname:[{required:!0,message:"请输入主机名",trigger:"blur"}],ip_address:[{required:!0,message:"请输入IP地址",trigger:"blur"},{pattern:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,message:"请输入有效的IP地址",trigger:"blur"}],os_type:[{required:!0,message:"请选择操作系统",trigger:"change"}],web_server:[{required:!0,message:"请选择Web服务器",trigger:"change"}]},A=o=>({online:"success",offline:"default",error:"error"})[o]||"default",V=o=>({online:"在线",offline:"离线",error:"错误"})[o]||o,H=o=>new Date(o).toLocaleString("zh-CN"),b=async()=>{I.value=!0;try{const o={page:v.current,limit:v.pageSize,search:g.keyword||void 0,status:g.status||void 0},e=await S.get("/servers",{params:o});e.success&&(R.value=e.data.items||[],v.total=e.data.total||0)}catch{i.error("加载服务器列表失败")}finally{I.value=!1}},$=()=>{v.current=1,b()},J=(o,e,p)=>{v.current=o.current,v.pageSize=o.pageSize,b()},M=()=>{b(),i.success("数据已刷新")},j=o=>{i.info(`编辑服务器: ${o.hostname}`)},Q=async(o,e)=>{try{await S.put(`/servers/${o.id}`,{auto_deploy:e}),o.auto_deploy=e,i.success(`自动部署已${e?"开启":"关闭"}`)}catch{i.error("更新自动部署设置失败")}},G=async o=>{try{await S.delete(`/servers/${o.id}`),i.success("服务器删除成功"),b()}catch{i.error("服务器删除失败")}},K=async()=>{try{await B.value.validate(),U.value=!0,await S.post("/servers",n),i.success("服务器添加成功"),y.value=!1,Object.assign(n,{hostname:"",ip_address:"",os_type:"",os_version:"",web_server:"",web_server_version:"",auto_deploy:!1}),b()}catch{i.error("服务器添加失败")}finally{U.value=!1}};return ne(()=>{b()}),(o,e)=>{const p=r("a-button"),D=r("a-space"),w=r("a-input"),z=r("a-col"),d=r("a-select-option"),h=r("a-select"),X=r("a-row"),E=r("router-link"),Y=r("a-tag"),Z=r("a-badge"),F=r("a-switch"),ee=r("a-popconfirm"),te=r("a-table"),ae=r("a-card"),m=r("a-form-item"),se=r("a-form"),oe=r("a-modal");return _(),c("div",pe,[t(ae,{title:"服务器管理",bordered:!1},{extra:a(()=>[t(D,null,{default:a(()=>[t(p,{type:"primary",onClick:e[0]||(e[0]=s=>y.value=!0)},{icon:a(()=>[t(O(ue))]),default:a(()=>[e[12]||(e[12]=l(" 添加服务器 "))]),_:1,__:[12]}),t(p,{onClick:M},{icon:a(()=>[t(O(de))]),default:a(()=>[e[13]||(e[13]=l(" 刷新 "))]),_:1,__:[13]})]),_:1})]),default:a(()=>[C("div",ve,[t(X,{gutter:[16,16]},{default:a(()=>[t(z,{xs:24,sm:12,md:8},{default:a(()=>[t(w,{value:g.keyword,"onUpdate:value":e[1]||(e[1]=s=>g.keyword=s),placeholder:"搜索主机名或IP地址",onPressEnter:$},{prefix:a(()=>[t(O(re))]),_:1},8,["value"])]),_:1}),t(z,{xs:24,sm:12,md:6},{default:a(()=>[t(h,{value:g.status,"onUpdate:value":e[2]||(e[2]=s=>g.status=s),placeholder:"选择状态","allow-clear":"",onChange:$},{default:a(()=>[t(d,{value:"online"},{default:a(()=>e[14]||(e[14]=[l("在线")])),_:1,__:[14]}),t(d,{value:"offline"},{default:a(()=>e[15]||(e[15]=[l("离线")])),_:1,__:[15]}),t(d,{value:"error"},{default:a(()=>e[16]||(e[16]=[l("错误")])),_:1,__:[16]})]),_:1},8,["value"])]),_:1}),t(z,{xs:24,sm:12,md:6},{default:a(()=>[t(p,{type:"primary",onClick:$},{default:a(()=>e[17]||(e[17]=[l("搜索")])),_:1,__:[17]})]),_:1})]),_:1})]),t(te,{columns:W,"data-source":R.value,pagination:v,loading:I.value,onChange:J,"row-key":"id",locale:{emptyText:""}},{emptyText:a(()=>[t(ie,{type:"servers","action-button":{text:"添加服务器",type:"primary",handler:()=>y.value=!0}},null,8,["action-button"])]),bodyCell:a(({column:s,record:u})=>[s.key==="hostname"?(_(),c(L,{key:0},[t(E,{to:`/servers/${u.id}`,class:"hostname-link"},{default:a(()=>[l(f(u.hostname),1)]),_:2},1032,["to"]),C("div",me,[t(Y,{size:"small"},{default:a(()=>[l(f(u.ip_address),1)]),_:2},1024)])],64)):k("",!0),s.key==="status"?(_(),P(Z,{key:1,status:A(u.status),text:V(u.status)},null,8,["status","text"])):k("",!0),s.key==="system_info"?(_(),c("div",fe,[C("div",null,f(u.os_type)+" "+f(u.os_version),1),C("div",ye,f(u.web_server)+" "+f(u.web_server_version),1)])):k("",!0),s.key==="auto_deploy"?(_(),P(F,{key:3,checked:u.auto_deploy,onChange:T=>Q(u,T),size:"small"},null,8,["checked","onChange"])):k("",!0),s.key==="last_heartbeat"?(_(),c(L,{key:4},[u.last_heartbeat?(_(),c("div",ge,f(H(u.last_heartbeat)),1)):(_(),c("span",be,"从未"))],64)):k("",!0),s.key==="actions"?(_(),P(D,{key:5},{default:a(()=>[t(E,{to:`/servers/${u.id}`},{default:a(()=>[t(p,{type:"link",size:"small"},{default:a(()=>e[18]||(e[18]=[l(" 查看详情 ")])),_:1,__:[18]})]),_:2},1032,["to"]),t(p,{type:"link",size:"small",onClick:T=>j(u)},{default:a(()=>e[19]||(e[19]=[l(" 编辑 ")])),_:2,__:[19]},1032,["onClick"]),t(ee,{title:"确定要删除这个服务器吗？",onConfirm:T=>G(u)},{default:a(()=>[t(p,{type:"link",size:"small",danger:""},{default:a(()=>e[20]||(e[20]=[l(" 删除 ")])),_:1,__:[20]})]),_:2},1032,["onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source","pagination","loading"])]),_:1}),t(oe,{open:y.value,"onUpdate:open":e[10]||(e[10]=s=>y.value=s),title:"添加服务器",onOk:K,onCancel:e[11]||(e[11]=s=>y.value=!1),"confirm-loading":U.value,width:"600px"},{default:a(()=>[t(se,{model:n,rules:q,layout:"vertical",ref_key:"createFormRef",ref:B},{default:a(()=>[t(m,{label:"主机名",name:"hostname"},{default:a(()=>[t(w,{value:n.hostname,"onUpdate:value":e[3]||(e[3]=s=>n.hostname=s),placeholder:"例如：web-server-01"},null,8,["value"])]),_:1}),t(m,{label:"IP地址",name:"ip_address"},{default:a(()=>[t(w,{value:n.ip_address,"onUpdate:value":e[4]||(e[4]=s=>n.ip_address=s),placeholder:"例如：192.168.1.100"},null,8,["value"])]),_:1}),t(m,{label:"操作系统",name:"os_type"},{default:a(()=>[t(h,{value:n.os_type,"onUpdate:value":e[5]||(e[5]=s=>n.os_type=s),placeholder:"选择操作系统"},{default:a(()=>[t(d,{value:"Ubuntu"},{default:a(()=>e[21]||(e[21]=[l("Ubuntu")])),_:1,__:[21]}),t(d,{value:"CentOS"},{default:a(()=>e[22]||(e[22]=[l("CentOS")])),_:1,__:[22]}),t(d,{value:"Debian"},{default:a(()=>e[23]||(e[23]=[l("Debian")])),_:1,__:[23]}),t(d,{value:"RHEL"},{default:a(()=>e[24]||(e[24]=[l("RHEL")])),_:1,__:[24]}),t(d,{value:"Windows"},{default:a(()=>e[25]||(e[25]=[l("Windows")])),_:1,__:[25]})]),_:1},8,["value"])]),_:1}),t(m,{label:"系统版本",name:"os_version"},{default:a(()=>[t(w,{value:n.os_version,"onUpdate:value":e[6]||(e[6]=s=>n.os_version=s),placeholder:"例如：20.04 LTS"},null,8,["value"])]),_:1}),t(m,{label:"Web服务器",name:"web_server"},{default:a(()=>[t(h,{value:n.web_server,"onUpdate:value":e[7]||(e[7]=s=>n.web_server=s),placeholder:"选择Web服务器"},{default:a(()=>[t(d,{value:"Nginx"},{default:a(()=>e[26]||(e[26]=[l("Nginx")])),_:1,__:[26]}),t(d,{value:"Apache"},{default:a(()=>e[27]||(e[27]=[l("Apache")])),_:1,__:[27]}),t(d,{value:"IIS"},{default:a(()=>e[28]||(e[28]=[l("IIS")])),_:1,__:[28]}),t(d,{value:"Caddy"},{default:a(()=>e[29]||(e[29]=[l("Caddy")])),_:1,__:[29]})]),_:1},8,["value"])]),_:1}),t(m,{label:"服务器版本",name:"web_server_version"},{default:a(()=>[t(w,{value:n.web_server_version,"onUpdate:value":e[8]||(e[8]=s=>n.web_server_version=s),placeholder:"例如：1.20.1"},null,8,["value"])]),_:1}),t(m,{label:"自动部署",name:"auto_deploy"},{default:a(()=>[t(F,{checked:n.auto_deploy,"onUpdate:checked":e[9]||(e[9]=s=>n.auto_deploy=s)},null,8,["checked"]),e[30]||(e[30]=C("div",{class:"form-help"}," 开启后，新证书将自动部署到此服务器 ",-1))]),_:1,__:[30]})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),Se=_e(ce,[["__scopeId","data-v-410c5195"]]);export{Se as default};
