import{c as e,I as Z,d as be,a as C,p as xe,j as ke,o as Ce,b as O,e as a,v as b,w as s,f as d,s as w,B as $,h as f,l as v,k as y,K as Oe,x as c,R as we,L as he,M as Se,O as Le,N as ze,y as J,P as De,i as Pe,m as p}from"./index-BA-staGq.js";import{L as $e,A as Q}from"./ActionFeedback-C8mGXM-p.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM769.1 441.7l-59.4 59.4-186.8-186.8 59.4-59.4c24.9-24.9 58.1-38.7 93.4-38.7 35.3 0 68.4 13.7 93.4 38.7 24.9 24.9 38.7 58.1 38.7 93.4 0 35.3-13.8 68.4-38.7 93.4zm-190.2 105a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 69-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2zM441.7 769.1a131.32 131.32 0 01-93.4 38.7c-35.3 0-68.4-13.7-93.4-38.7a131.32 131.32 0 01-38.7-93.4c0-35.3 13.7-68.4 38.7-93.4l59.4-59.4 186.8 186.8-59.4 59.4z"}}]},name:"api",theme:"outlined"};function X(r){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?Object(arguments[o]):{},_=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(i).filter(function(m){return Object.getOwnPropertyDescriptor(i,m).enumerable}))),_.forEach(function(m){Ie(r,m,i[m])})}return r}function Ie(r,o,i){return o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r}var V=function(o,i){var _=X({},o,i.attrs);return e(Z,X({},_,{icon:je}),null)};V.displayName="ApiOutlined";V.inheritAttrs=!1;var Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};function Y(r){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?Object(arguments[o]):{},_=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(i).filter(function(m){return Object.getOwnPropertyDescriptor(i,m).enumerable}))),_.forEach(function(m){Ne(r,m,i[m])})}return r}function Ne(r,o,i){return o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r}var R=function(o,i){var _=Y({},o,i.attrs);return e(Z,Y({},_,{icon:Be}),null)};R.displayName="CloudUploadOutlined";R.inheritAttrs=!1;const Me={class:"server-detail-container"},Ue={class:"page-header"},Ve={style:{margin:"0"}},Re={key:1,class:"server-content"},Ee={class:"info-item"},Te={class:"value"},He={class:"info-item"},Fe={class:"value"},We={class:"info-item"},qe={class:"value"},Ge={class:"info-item"},Je={class:"value"},Qe={class:"info-item"},Xe={class:"value"},Ye={class:"info-item"},Ze={class:"value"},Ke={class:"info-item"},et={class:"value"},tt={key:0},st={key:1,class:"text-muted"},at={class:"info-item"},nt={class:"value"},lt={key:1,class:"text-muted"},ot={class:"info-item"},it={class:"value"},rt={class:"info-item"},ut={class:"value"},dt={class:"connection-status"},ct={class:"status-chart"},_t={class:"info-item"},ft={class:"value"},vt={class:"info-item"},mt={class:"value"},pt={class:"info-item"},yt={class:"value"},gt={class:"info-item"},bt={class:"value"},xt={class:"info-item"},kt={class:"value"},Ct={class:"note-content"},Ot=be({__name:"ServerDetail",setup(r){const o=ke(),i=Pe(),_=C(!1),m=C(!1),A=C(!1),j=C(!1),l=C(null),E=C([]),h=C(""),L=xe(()=>o.params.id),K=[{title:"域名",dataIndex:"domain",key:"domain"},{title:"状态",dataIndex:"status",key:"status"},{title:"剩余天数",dataIndex:"days_remaining",key:"days_remaining"},{title:"部署时间",dataIndex:"deployed_at",key:"deployed_at"},{title:"操作",key:"actions",width:150}],T=n=>({online:"success",offline:"default",error:"error",maintenance:"warning"})[n]||"default",H=n=>({online:"在线",offline:"离线",error:"错误",maintenance:"维护中"})[n]||n,ee=n=>({deployed:"green",pending:"blue",failed:"red",expired:"orange"})[n]||"default",te=n=>({deployed:"已部署",pending:"部署中",failed:"部署失败",expired:"已过期"})[n]||n,se=n=>n<=0?"text-danger":n<=7?"text-warning":n<=30?"text-info":"text-success",ae=n=>n>1e3?"text-danger":n>500?"text-warning":n>100?"text-info":"text-success",I=n=>n>=90?"exception":n>=70?"active":"normal",B=n=>n?new Date(n).toLocaleString("zh-CN"):"-",z=async()=>{_.value=!0,h.value="";try{const n=await $.get(`/servers/${L.value}`);n.success?l.value=n.data.server||n.data:h.value=n.message||"加载服务器详情失败"}catch(n){h.value=n.message||"网络错误",console.error("加载服务器详情失败:",n)}finally{_.value=!1}},F=async()=>{j.value=!0;try{const n=await $.get(`/servers/${L.value}/certificates`);n.success&&(E.value=n.data.certificates||n.data.items||[])}catch(n){console.error("加载服务器证书失败:",n)}finally{j.value=!1}},N=()=>{i.back()},ne=()=>{z(),F(),p.success("数据已刷新")},le=async()=>{m.value=!0;try{await $.post(`/servers/${L.value}/test`),p.success("服务器连接测试成功"),z()}catch{p.error("服务器连接测试失败")}finally{m.value=!1}},oe=async n=>{A.value=!0;try{await $.put(`/servers/${L.value}`,{auto_deploy:n}),l.value.auto_deploy=n,p.success(`自动部署已${n?"开启":"关闭"}`)}catch{p.error("更新自动部署设置失败")}finally{A.value=!1}},W=()=>{p.info("部署新证书功能开发中")},ie=n=>{p.info(`重新部署证书: ${n.domain}`)},re=n=>{p.info(`移除证书: ${n.domain}`)},ue=({key:n})=>{switch(n){case"edit":p.info("编辑配置功能开发中");break;case"deploy":W();break;case"logs":p.info("查看日志功能开发中");break;case"delete":p.info("删除服务器功能开发中");break}};return Ce(()=>{z(),F()}),(n,t)=>{const x=d("a-button"),de=d("a-divider"),q=d("a-badge"),M=d("a-space"),u=d("a-col"),D=d("a-menu-item"),ce=d("a-menu-divider"),_e=d("a-menu"),fe=d("a-dropdown"),P=d("a-row"),G=d("a-tag"),ve=d("a-switch"),S=d("a-card"),me=d("a-empty"),pe=d("router-link"),ye=d("a-table"),U=d("a-progress");return f(),O("div",Me,[a("div",Ue,[e(P,{justify:"space-between",align:"middle"},{default:s(()=>[e(u,null,{default:s(()=>[e(M,null,{default:s(()=>{var k;return[e(x,{onClick:N,type:"text"},{icon:s(()=>[e(y(Oe))]),default:s(()=>[t[0]||(t[0]=v(" 返回 "))]),_:1,__:[0]}),e(de,{type:"vertical"}),a("h2",Ve,c(((k=l.value)==null?void 0:k.hostname)||"服务器详情"),1),l.value?(f(),b(q,{key:0,status:T(l.value.status),text:H(l.value.status)},null,8,["status","text"])):w("",!0)]}),_:1})]),_:1}),e(u,null,{default:s(()=>[e(M,null,{default:s(()=>[e(x,{onClick:ne},{icon:s(()=>[e(y(we))]),default:s(()=>[t[1]||(t[1]=v(" 刷新 "))]),_:1,__:[1]}),e(x,{type:"primary",onClick:le,loading:m.value},{icon:s(()=>[e(y(V))]),default:s(()=>[t[2]||(t[2]=v(" 测试连接 "))]),_:1,__:[2]},8,["loading"]),e(fe,null,{overlay:s(()=>[e(_e,{onClick:ue},{default:s(()=>[e(D,{key:"edit"},{default:s(()=>[e(y(Se)),t[4]||(t[4]=v(" 编辑配置 "))]),_:1,__:[4]}),e(D,{key:"deploy"},{default:s(()=>[e(y(R)),t[5]||(t[5]=v(" 部署证书 "))]),_:1,__:[5]}),e(D,{key:"logs"},{default:s(()=>[e(y(Le)),t[6]||(t[6]=v(" 查看日志 "))]),_:1,__:[6]}),e(ce),e(D,{key:"delete",danger:""},{default:s(()=>[e(y(ze)),t[7]||(t[7]=v(" 删除服务器 "))]),_:1,__:[7]})]),_:1})]),default:s(()=>[e(x,null,{default:s(()=>[t[3]||(t[3]=v(" 更多操作 ")),e(y(he))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1})]),_:1})]),_.value?(f(),b($e,{key:0,text:"加载服务器详情中...",description:"正在获取服务器的详细信息和状态，请稍候"})):l.value?(f(),O("div",Re,[e(S,{title:"基本信息",class:"info-card"},{default:s(()=>[e(P,{gutter:[24,16]},{default:s(()=>[e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",Ee,[t[8]||(t[8]=a("label",null,"主机名",-1)),a("div",Te,c(l.value.hostname),1)])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",He,[t[9]||(t[9]=a("label",null,"IP地址",-1)),a("div",Fe,[e(G,{color:"blue"},{default:s(()=>[v(c(l.value.ip_address),1)]),_:1})])])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",We,[t[10]||(t[10]=a("label",null,"服务器状态",-1)),a("div",qe,[e(q,{status:T(l.value.status),text:H(l.value.status)},null,8,["status","text"])])])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",Ge,[t[11]||(t[11]=a("label",null,"操作系统",-1)),a("div",Je,c(l.value.os_type)+" "+c(l.value.os_version),1)])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",Qe,[t[12]||(t[12]=a("label",null,"Web服务器",-1)),a("div",Xe,c(l.value.web_server)+" "+c(l.value.web_server_version),1)])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",Ye,[t[13]||(t[13]=a("label",null,"自动部署",-1)),a("div",Ze,[e(ve,{checked:l.value.auto_deploy,onChange:oe,loading:A.value},null,8,["checked","loading"])])])]),_:1})]),_:1})]),_:1}),e(S,{title:"连接信息",class:"info-card"},{default:s(()=>[e(P,{gutter:[24,16]},{default:s(()=>[e(u,{xs:24,sm:12},{default:s(()=>[a("div",Ke,[t[14]||(t[14]=a("label",null,"最后心跳",-1)),a("div",et,[l.value.last_heartbeat?(f(),O("span",tt,c(B(l.value.last_heartbeat)),1)):(f(),O("span",st,"从未"))])])]),_:1}),e(u,{xs:24,sm:12},{default:s(()=>[a("div",at,[t[15]||(t[15]=a("label",null,"连接延迟",-1)),a("div",nt,[l.value.ping_latency?(f(),O("span",{key:0,class:J(ae(l.value.ping_latency))},c(l.value.ping_latency)+"ms ",3)):(f(),O("span",lt,"未知"))])])]),_:1}),e(u,{xs:24,sm:12},{default:s(()=>[a("div",ot,[t[16]||(t[16]=a("label",null,"创建时间",-1)),a("div",it,c(B(l.value.created_at)),1)])]),_:1}),e(u,{xs:24,sm:12},{default:s(()=>[a("div",rt,[t[17]||(t[17]=a("label",null,"更新时间",-1)),a("div",ut,c(B(l.value.updated_at)),1)])]),_:1})]),_:1}),a("div",dt,[t[18]||(t[18]=a("h4",null,"连接状态历史",-1)),a("div",ct,[e(me,{description:"连接状态图表功能开发中"})])])]),_:1}),e(S,{title:"部署的证书",class:"info-card"},{extra:s(()=>[e(x,{type:"link",onClick:W},{icon:s(()=>[e(y(De))]),default:s(()=>[t[19]||(t[19]=v(" 部署新证书 "))]),_:1,__:[19]})]),default:s(()=>[e(ye,{columns:K,"data-source":E.value,pagination:!1,loading:j.value,size:"small"},{bodyCell:s(({column:k,record:g})=>[k.key==="domain"?(f(),b(pe,{key:0,to:`/certificates/${g.id}`,class:"domain-link"},{default:s(()=>[v(c(g.domain),1)]),_:2},1032,["to"])):w("",!0),k.key==="status"?(f(),b(G,{key:1,color:ee(g.status)},{default:s(()=>[v(c(te(g.status)),1)]),_:2},1032,["color"])):w("",!0),k.key==="days_remaining"?(f(),O("span",{key:2,class:J(se(g.days_remaining))},c(g.days_remaining)+"天 ",3)):w("",!0),k.key==="actions"?(f(),b(M,{key:3},{default:s(()=>[e(x,{type:"link",size:"small",onClick:ge=>ie(g)},{default:s(()=>t[20]||(t[20]=[v(" 重新部署 ")])),_:2,__:[20]},1032,["onClick"]),e(x,{type:"link",size:"small",onClick:ge=>re(g),danger:""},{default:s(()=>t[21]||(t[21]=[v(" 移除 ")])),_:2,__:[21]},1032,["onClick"])]),_:2},1024)):w("",!0)]),_:1},8,["data-source","loading"])]),_:1}),e(S,{title:"系统信息",class:"info-card"},{default:s(()=>[e(P,{gutter:[24,16]},{default:s(()=>[e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",_t,[t[22]||(t[22]=a("label",null,"CPU使用率",-1)),a("div",ft,[e(U,{percent:l.value.cpu_usage||0,size:"small",status:I(l.value.cpu_usage)},null,8,["percent","status"])])])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",vt,[t[23]||(t[23]=a("label",null,"内存使用率",-1)),a("div",mt,[e(U,{percent:l.value.memory_usage||0,size:"small",status:I(l.value.memory_usage)},null,8,["percent","status"])])])]),_:1}),e(u,{xs:24,sm:12,md:8},{default:s(()=>[a("div",pt,[t[24]||(t[24]=a("label",null,"磁盘使用率",-1)),a("div",yt,[e(U,{percent:l.value.disk_usage||0,size:"small",status:I(l.value.disk_usage)},null,8,["percent","status"])])])]),_:1}),e(u,{xs:24,sm:12},{default:s(()=>[a("div",gt,[t[25]||(t[25]=a("label",null,"系统负载",-1)),a("div",bt,c(l.value.load_average||"未知"),1)])]),_:1}),e(u,{xs:24,sm:12},{default:s(()=>[a("div",xt,[t[26]||(t[26]=a("label",null,"运行时间",-1)),a("div",kt,c(l.value.uptime||"未知"),1)])]),_:1})]),_:1})]),_:1}),l.value.note?(f(),b(S,{key:0,title:"备注信息",class:"info-card"},{default:s(()=>[a("div",Ct,c(l.value.note),1)]),_:1})):w("",!0)])):h.value?(f(),b(Q,{key:2,type:"error",title:"加载失败",description:h.value,"primary-action":{text:"重试",handler:z},"secondary-action":{text:"返回列表",handler:N}},null,8,["description","primary-action","secondary-action"])):(f(),b(Q,{key:3,type:"404",title:"服务器不存在",description:"请检查服务器ID是否正确，或者该服务器可能已被删除","primary-action":{text:"返回列表",handler:N}},null,8,["primary-action"]))])}}}),Lt=Ae(Ot,[["__scopeId","data-v-9bbbae3a"]]);export{Lt as default};
