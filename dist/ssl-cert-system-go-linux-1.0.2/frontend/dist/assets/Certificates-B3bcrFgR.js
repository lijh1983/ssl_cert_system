import{d as le,a as g,r as E,o as ie,b as k,c as t,w as a,f as s,B as w,m as d,h as _,e as D,k as R,J as de,l as r,s as C,v as U,F as P,x as b,t as ue,y as _e,P as ce,R as pe}from"./index-BA-staGq.js";import{E as me}from"./EmptyState-Bc6z0PfQ.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"certificates-container"},ve={class:"search-section"},ge={key:0,class:"alt-domains"},ke=le({__name:"Certificates",setup(we){const z=g(!1),S=g(!1),m=g(!1),F=g([]),I=g(),f=E({keyword:"",status:void 0}),l=E({domain:"",alt_domains:[],encryption_type:"ECC",auto_renew:!0,note:""}),c=E({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条记录`}),q=[{title:"域名",dataIndex:"domain",key:"domain"},{title:"颁发者",dataIndex:"issuer",key:"issuer"},{title:"状态",dataIndex:"status",key:"status"},{title:"剩余天数",dataIndex:"days_remaining",key:"days_remaining",sorter:!0},{title:"创建时间",dataIndex:"created_at",key:"created_at",sorter:!0},{title:"操作",key:"actions",width:200}],J={domain:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,message:"请输入有效的域名",trigger:"blur"}],encryption_type:[{required:!0,message:"请选择加密类型",trigger:"change"}]},L=o=>({issued:"green",pending:"blue",expired:"red",error:"red",revoked:"orange"})[o]||"default",M=o=>({issued:"已签发",pending:"待处理",expired:"已过期",error:"错误",revoked:"已撤销"})[o]||o,j=o=>o<=0?"text-danger":o<=7?"text-warning":o<=30?"text-info":"text-success",p=async()=>{z.value=!0;try{const o={page:c.current,limit:c.pageSize,search:f.keyword||void 0,status:f.status||void 0},e=await w.get("/certificates",{params:o});e.success&&(F.value=e.data.items||[],c.total=e.data.total||0)}catch{d.error("加载证书列表失败")}finally{z.value=!1}},$=()=>{c.current=1,p()},Q=(o,e,u)=>{c.current=o.current,c.pageSize=o.pageSize,p()},G=()=>{p(),d.success("数据已刷新")},H=async o=>{try{await w.post(`/certificates/${o.id}/renew`),d.success("证书续期请求已提交"),p()}catch{d.error("证书续期失败")}},K=async o=>{try{await w.download(`/certificates/${o.id}/download`,`${o.domain}.zip`),d.success("证书下载成功")}catch{d.error("证书下载失败")}},W=async o=>{try{await w.delete(`/certificates/${o.id}`),d.success("证书删除成功"),p()}catch{d.error("证书删除失败")}},X=async()=>{try{await I.value.validate(),S.value=!0,await w.post("/certificates",l),d.success("证书申请已提交"),m.value=!1,Object.assign(l,{domain:"",alt_domains:[],encryption_type:"ECC",auto_renew:!0,note:""}),p()}catch{d.error("证书申请失败")}finally{S.value=!1}};return ie(()=>{p()}),(o,e)=>{const u=s("a-button"),T=s("a-space"),Z=s("a-input"),A=s("a-col"),x=s("a-select-option"),B=s("a-select"),Y=s("a-row"),O=s("router-link"),N=s("a-tag"),h=s("a-popconfirm"),ee=s("a-table"),te=s("a-card"),y=s("a-form-item"),V=s("a-radio"),ae=s("a-radio-group"),oe=s("a-switch"),ne=s("a-textarea"),se=s("a-form"),re=s("a-modal");return _(),k("div",ye,[t(te,{title:"证书管理",bordered:!1},{extra:a(()=>[t(T,null,{default:a(()=>[t(u,{type:"primary",onClick:e[0]||(e[0]=n=>m.value=!0)},{icon:a(()=>[t(R(ce))]),default:a(()=>[e[10]||(e[10]=r(" 申请证书 "))]),_:1,__:[10]}),t(u,{onClick:G},{icon:a(()=>[t(R(pe))]),default:a(()=>[e[11]||(e[11]=r(" 刷新 "))]),_:1,__:[11]})]),_:1})]),default:a(()=>[D("div",ve,[t(Y,{gutter:[16,16]},{default:a(()=>[t(A,{xs:24,sm:12,md:8},{default:a(()=>[t(Z,{value:f.keyword,"onUpdate:value":e[1]||(e[1]=n=>f.keyword=n),placeholder:"搜索域名或颁发者",onPressEnter:$},{prefix:a(()=>[t(R(de))]),_:1},8,["value"])]),_:1}),t(A,{xs:24,sm:12,md:6},{default:a(()=>[t(B,{value:f.status,"onUpdate:value":e[2]||(e[2]=n=>f.status=n),placeholder:"选择状态","allow-clear":"",onChange:$},{default:a(()=>[t(x,{value:"issued"},{default:a(()=>e[12]||(e[12]=[r("已签发")])),_:1,__:[12]}),t(x,{value:"pending"},{default:a(()=>e[13]||(e[13]=[r("待处理")])),_:1,__:[13]}),t(x,{value:"expired"},{default:a(()=>e[14]||(e[14]=[r("已过期")])),_:1,__:[14]}),t(x,{value:"error"},{default:a(()=>e[15]||(e[15]=[r("错误")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),t(A,{xs:24,sm:12,md:6},{default:a(()=>[t(u,{type:"primary",onClick:$},{default:a(()=>e[16]||(e[16]=[r("搜索")])),_:1,__:[16]})]),_:1})]),_:1})]),t(ee,{columns:q,"data-source":F.value,pagination:c,loading:z.value,onChange:Q,"row-key":"id",locale:{emptyText:""}},{emptyText:a(()=>[t(me,{type:"certificates","action-button":{text:"申请证书",type:"primary",handler:()=>m.value=!0}},null,8,["action-button"])]),bodyCell:a(({column:n,record:i})=>[n.key==="domain"?(_(),k(P,{key:0},[t(O,{to:`/certificates/${i.id}`,class:"domain-link"},{default:a(()=>[r(b(i.domain),1)]),_:2},1032,["to"]),i.alt_domains?(_(),k("div",ge,[(_(!0),k(P,null,ue(i.alt_domains.split(","),v=>(_(),U(N,{key:v,size:"small"},{default:a(()=>[r(b(v.trim()),1)]),_:2},1024))),128))])):C("",!0)],64)):C("",!0),n.key==="status"?(_(),U(N,{key:1,color:L(i.status)},{default:a(()=>[r(b(M(i.status)),1)]),_:2},1032,["color"])):C("",!0),n.key==="days_remaining"?(_(),k("span",{key:2,class:_e(j(i.days_remaining))},b(i.days_remaining)+"天 ",3)):C("",!0),n.key==="actions"?(_(),U(T,{key:3},{default:a(()=>[t(O,{to:`/certificates/${i.id}`},{default:a(()=>[t(u,{type:"link",size:"small"},{default:a(()=>e[17]||(e[17]=[r(" 查看详情 ")])),_:1,__:[17]})]),_:2},1032,["to"]),t(u,{type:"link",size:"small",onClick:v=>H(i)},{default:a(()=>e[18]||(e[18]=[r(" 续期 ")])),_:2,__:[18]},1032,["onClick"]),t(u,{type:"link",size:"small",onClick:v=>K(i)},{default:a(()=>e[19]||(e[19]=[r(" 下载 ")])),_:2,__:[19]},1032,["onClick"]),t(h,{title:"确定要删除这个证书吗？",onConfirm:v=>W(i)},{default:a(()=>[t(u,{type:"link",size:"small",danger:""},{default:a(()=>e[20]||(e[20]=[r(" 删除 ")])),_:1,__:[20]})]),_:2},1032,["onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["data-source","pagination","loading"])]),_:1}),t(re,{open:m.value,"onUpdate:open":e[8]||(e[8]=n=>m.value=n),title:"申请新证书",onOk:X,onCancel:e[9]||(e[9]=n=>m.value=!1),"confirm-loading":S.value,width:"600px"},{default:a(()=>[t(se,{model:l,rules:J,layout:"vertical",ref_key:"createFormRef",ref:I},{default:a(()=>[t(y,{label:"主域名",name:"domain"},{default:a(()=>[t(Z,{value:l.domain,"onUpdate:value":e[3]||(e[3]=n=>l.domain=n),placeholder:"例如：example.com"},null,8,["value"])]),_:1}),t(y,{label:"备用域名",name:"alt_domains"},{default:a(()=>[t(B,{value:l.alt_domains,"onUpdate:value":e[4]||(e[4]=n=>l.alt_domains=n),mode:"tags",placeholder:"例如：www.example.com, api.example.com","token-separators":[","," "]},null,8,["value"])]),_:1}),t(y,{label:"加密类型",name:"encryption_type"},{default:a(()=>[t(ae,{value:l.encryption_type,"onUpdate:value":e[5]||(e[5]=n=>l.encryption_type=n)},{default:a(()=>[t(V,{value:"ECC"},{default:a(()=>e[21]||(e[21]=[r("ECC (推荐)")])),_:1,__:[21]}),t(V,{value:"RSA"},{default:a(()=>e[22]||(e[22]=[r("RSA")])),_:1,__:[22]})]),_:1},8,["value"])]),_:1}),t(y,{label:"自动续期",name:"auto_renew"},{default:a(()=>[t(oe,{checked:l.auto_renew,"onUpdate:checked":e[6]||(e[6]=n=>l.auto_renew=n)},null,8,["checked"]),e[23]||(e[23]=D("div",{class:"form-help"}," 开启后，证书将在到期前30天自动续期 ",-1))]),_:1,__:[23]}),t(y,{label:"备注",name:"note"},{default:a(()=>[t(ne,{value:l.note,"onUpdate:value":e[7]||(e[7]=n=>l.note=n),placeholder:"可选的备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),ze=fe(ke,[["__scopeId","data-v-df02a4f8"]]);export{ze as default};
