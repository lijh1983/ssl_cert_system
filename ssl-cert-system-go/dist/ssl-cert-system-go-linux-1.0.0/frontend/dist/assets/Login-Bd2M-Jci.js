import{c as r,I as N,d as H,u as A,r as k,a as v,o as E,b as D,e as c,w as t,f as g,g as P,h as T,i as G,j as J,k as x,U as Q,l as O,n as L,m as F}from"./index-BA-staGq.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};function S(m){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?Object(arguments[n]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable}))),d.forEach(function(s){Y(m,s,l[s])})}return m}function Y(m,n,l){return n in m?Object.defineProperty(m,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):m[n]=l,m}var y=function(n,l){var d=S({},n,l.attrs);return r(N,S({},d,{icon:X}),null)};y.displayName="LockOutlined";y.inheritAttrs=!1;const Z={class:"login-container"},K={class:"login-box"},ee={class:"login-footer"},re={class:"login-links"},ae=H({__name:"Login",setup(m){const n=G(),l=J(),d=A(),s=k({emailOrUsername:"",password:"",remember:!1}),o=k({username:"",email:"",password:"",confirmPassword:""}),b=v(!1),_=v(!1),f=v(!1),j=v(!1),h=v(),q={emailOrUsername:[{required:!0,message:"请输入用户名或邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}]},z={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度为3-20位",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(i,e)=>e!==o.password?Promise.reject("两次输入的密码不一致"):Promise.resolve(),trigger:"blur"}]},R=async i=>{var e;b.value=!0;try{await d.login(i);const p=`欢迎回来，${((e=d.user)==null?void 0:e.username)||"用户"}！`;L.success({title:"登录成功",description:p,duration:3});const u=l.query.redirect;n.push(u||"/")}catch(p){L.error({title:"登录失败",description:p.message||"登录失败，请重试",duration:5})}finally{b.value=!1}},V=i=>{console.log("登录表单验证失败:",i)},C=async()=>{try{await h.value.validate(),_.value=!0,await d.register({username:o.username,email:o.email,password:o.password}),F.success("注册成功，请登录"),f.value=!1,Object.assign(o,{username:"",email:"",password:"",confirmPassword:""})}catch(i){F.error(i.message||"注册失败")}finally{_.value=!1}};return E(()=>{const i=localStorage.getItem("rememberedUsername"),e=localStorage.getItem("rememberLogin");i&&e==="true"&&(s.emailOrUsername=i,s.remember=!0)}),(i,e)=>{const p=g("a-input"),u=g("a-form-item"),w=g("a-input-password"),M=g("a-checkbox"),I=g("a-button"),U=g("a-form"),$=g("a-divider"),B=g("a-modal");return T(),D("div",Z,[c("div",K,[e[14]||(e[14]=c("div",{class:"login-header"},[c("h1",null,"SSL证书管理系统"),c("p",null,"请登录您的账户")],-1)),r(U,{model:s,rules:q,onFinish:R,onFinishFailed:V,layout:"vertical",class:"login-form"},{default:t(()=>[r(u,{label:"用户名/邮箱",name:"emailOrUsername"},{default:t(()=>[r(p,{value:s.emailOrUsername,"onUpdate:value":e[0]||(e[0]=a=>s.emailOrUsername=a),size:"large",placeholder:"请输入用户名或邮箱"},{prefix:t(()=>[r(x(Q))]),_:1},8,["value"])]),_:1}),r(u,{label:"密码",name:"password"},{default:t(()=>[r(w,{value:s.password,"onUpdate:value":e[1]||(e[1]=a=>s.password=a),size:"large",placeholder:"请输入密码"},{prefix:t(()=>[r(x(y))]),_:1},8,["value"])]),_:1}),r(u,null,{default:t(()=>[r(M,{checked:s.remember,"onUpdate:checked":e[2]||(e[2]=a=>s.remember=a)},{default:t(()=>e[11]||(e[11]=[O(" 记住我 ")])),_:1,__:[11]},8,["checked"])]),_:1}),r(u,null,{default:t(()=>[r(I,{type:"primary","html-type":"submit",size:"large",loading:b.value,block:""},{default:t(()=>e[12]||(e[12]=[O(" 登录 ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1},8,["model"]),c("div",ee,[r($,null,{default:t(()=>e[13]||(e[13]=[O("其他选项")])),_:1,__:[13]}),c("div",re,[c("a",{href:"#",onClick:e[3]||(e[3]=P(a=>f.value=!0,["prevent"]))},"注册账户"),c("a",{href:"#",onClick:e[4]||(e[4]=P(a=>j.value=!0,["prevent"]))},"忘记密码")])])]),r(B,{open:f.value,"onUpdate:open":e[9]||(e[9]=a=>f.value=a),title:"注册新账户",onOk:C,onCancel:e[10]||(e[10]=a=>f.value=!1),"confirm-loading":_.value},{default:t(()=>[r(U,{model:o,rules:z,layout:"vertical",ref_key:"registerFormRef",ref:h},{default:t(()=>[r(u,{label:"用户名",name:"username"},{default:t(()=>[r(p,{value:o.username,"onUpdate:value":e[5]||(e[5]=a=>o.username=a),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),r(u,{label:"邮箱",name:"email"},{default:t(()=>[r(p,{value:o.email,"onUpdate:value":e[6]||(e[6]=a=>o.email=a),placeholder:"请输入邮箱地址"},null,8,["value"])]),_:1}),r(u,{label:"密码",name:"password"},{default:t(()=>[r(w,{value:o.password,"onUpdate:value":e[7]||(e[7]=a=>o.password=a),placeholder:"请输入密码"},null,8,["value"])]),_:1}),r(u,{label:"确认密码",name:"confirmPassword"},{default:t(()=>[r(w,{value:o.confirmPassword,"onUpdate:value":e[8]||(e[8]=a=>o.confirmPassword=a),placeholder:"请再次输入密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),oe=W(ae,[["__scopeId","data-v-53ab6a69"]]);export{oe as default};
