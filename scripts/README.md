# éƒ¨ç½²å’Œç®¡ç†è„šæœ¬

æœ¬ç›®å½•åŒ…å«SSLè¯ä¹¦ç®¡ç†ç³»ç»Ÿçš„éƒ¨ç½²å’Œç®¡ç†è„šæœ¬ï¼Œé€‚ç”¨äºåŸç”Ÿéƒ¨ç½²ç¯å¢ƒã€‚

## ğŸ“œ è„šæœ¬åˆ—è¡¨

### ğŸš€ install-native.sh
**ç¯å¢ƒå®‰è£…è„šæœ¬**

è‡ªåŠ¨å®‰è£…ç³»ç»Ÿç¯å¢ƒï¼ŒåŒ…æ‹¬Goã€Node.jsã€MySQLã€Nginxç­‰ä¾èµ–ã€‚

```bash
# ä½¿ç”¨æ–¹æ³•ï¼ˆéœ€è¦rootæƒé™ï¼‰
sudo ./scripts/install-native.sh
```

**åŠŸèƒ½**ï¼š
- æ£€æŸ¥æ“ä½œç³»ç»Ÿå…¼å®¹æ€§
- æ›´æ–°ç³»ç»ŸåŒ…
- å®‰è£…Go 1.21+
- å®‰è£…Node.js 18+
- å®‰è£…MySQL 8.0+
- å®‰è£…Nginx
- é…ç½®é˜²ç«å¢™
- åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
- ç”Ÿæˆç¯å¢ƒé…ç½®æ¨¡æ¿

**æ”¯æŒç³»ç»Ÿ**ï¼šUbuntu 20.04+, Debian 11+

### ğŸ”§ deploy-native.sh
**åº”ç”¨éƒ¨ç½²è„šæœ¬**

è‡ªåŠ¨åŒ–éƒ¨ç½²SSLè¯ä¹¦ç®¡ç†ç³»ç»Ÿåˆ°ç”Ÿäº§ç¯å¢ƒã€‚

```bash
# ä½¿ç”¨æ–¹æ³•
./scripts/deploy-native.sh
```

**åŠŸèƒ½**ï¼š
- æ£€æŸ¥ç³»ç»Ÿä¾èµ–
- å¤‡ä»½å½“å‰ç‰ˆæœ¬
- æ‹‰å–æœ€æ–°ä»£ç 
- æ„å»ºå‰ç«¯å’Œåç«¯
- è®¾ç½®æ–‡ä»¶æƒé™
- é‡å¯åº”ç”¨æœåŠ¡
- é‡æ–°åŠ è½½Nginx
- æ‰§è¡Œå¥åº·æ£€æŸ¥

**å‰ç½®æ¡ä»¶**ï¼š
- å·²è¿è¡Œ `install-native.sh`
- åº”ç”¨ç›®å½•å­˜åœ¨äº `/opt/ssl-cert-system`
- ç¯å¢ƒå˜é‡å·²é…ç½®

### ğŸ” health-check.sh
**å¥åº·æ£€æŸ¥è„šæœ¬**

å…¨é¢æ£€æŸ¥ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œå¥åº·æŒ‡æ ‡ã€‚

```bash
# ä½¿ç”¨æ–¹æ³•
./scripts/health-check.sh
```

**æ£€æŸ¥é¡¹ç›®**ï¼š
- ç³»ç»ŸæœåŠ¡çŠ¶æ€ï¼ˆnginx, mysql, ssl-cert-systemï¼‰
- ç«¯å£ç›‘å¬çŠ¶æ€
- åº”ç”¨å¥åº·çŠ¶æ€
- æ•°æ®åº“è¿æ¥
- ç£ç›˜ç©ºé—´ä½¿ç”¨
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- åº”ç”¨è¿›ç¨‹çŠ¶æ€
- æ—¥å¿—é”™è¯¯æ£€æŸ¥
- SSLè¯ä¹¦å­˜å‚¨æ£€æŸ¥

**è¾“å‡º**ï¼š
- å½©è‰²çŠ¶æ€æŒ‡ç¤º
- è¯¦ç»†å¥åº·æŠ¥å‘Š
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### ğŸ’¾ backup.sh
**å¤‡ä»½è„šæœ¬**

åˆ›å»ºå®Œæ•´çš„ç³»ç»Ÿå¤‡ä»½ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€åº”ç”¨æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰ã€‚

```bash
# ä½¿ç”¨æ–¹æ³•
./scripts/backup.sh
```

**å¤‡ä»½å†…å®¹**ï¼š
- æ•°æ®åº“ï¼ˆå‹ç¼©SQLæ–‡ä»¶ï¼‰
- åº”ç”¨æ–‡ä»¶ï¼ˆæ’é™¤ä¸´æ—¶æ–‡ä»¶ï¼‰
- SSLè¯ä¹¦æ–‡ä»¶
- é…ç½®æ–‡ä»¶ï¼ˆ.env, nginx, systemdï¼‰
- å¤‡ä»½ä¿¡æ¯æ–‡ä»¶

**å¤‡ä»½ä½ç½®**ï¼š`/opt/backups/ssl-cert-system/YYYYMMDD_HHMMSS/`

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨å‹ç¼©å¤‡ä»½æ–‡ä»¶
- éªŒè¯å¤‡ä»½å®Œæ•´æ€§
- æ¸…ç†æ—§å¤‡ä»½ï¼ˆé»˜è®¤ä¿ç•™30å¤©ï¼‰
- ç”Ÿæˆæ¢å¤è¯´æ˜

## ğŸ”§ ä½¿ç”¨æµç¨‹

### é¦–æ¬¡éƒ¨ç½²

1. **ç¯å¢ƒå®‰è£…**
```bash
# åœ¨æ–°æœåŠ¡å™¨ä¸Šå®‰è£…ç¯å¢ƒ
sudo ./scripts/install-native.sh
```

2. **è·å–ä»£ç **
```bash
cd /opt/ssl-cert-system
git clone https://github.com/lijh1983/ssl_cert_system.git .
```

3. **é…ç½®ç¯å¢ƒ**
```bash
cp .env.template .env
nano .env  # ä¿®æ”¹å¿…è¦é…ç½®
```

4. **éƒ¨ç½²åº”ç”¨**
```bash
./scripts/deploy-native.sh
```

### æ—¥å¸¸ç»´æŠ¤

1. **æ›´æ–°éƒ¨ç½²**
```bash
./scripts/deploy-native.sh
```

2. **å¥åº·æ£€æŸ¥**
```bash
./scripts/health-check.sh
```

3. **åˆ›å»ºå¤‡ä»½**
```bash
./scripts/backup.sh
```

### å®šæ—¶ä»»åŠ¡

å»ºè®®è®¾ç½®ä»¥ä¸‹å®šæ—¶ä»»åŠ¡ï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /opt/ssl-cert-system/scripts/backup.sh >> /var/log/ssl-cert-backup.log 2>&1

# æ¯å°æ—¶å¥åº·æ£€æŸ¥
0 * * * * /opt/ssl-cert-system/scripts/health-check.sh >> /var/log/ssl-cert-health.log 2>&1

# æ¯å‘¨æ—¥å‡Œæ™¨4ç‚¹æ›´æ–°éƒ¨ç½²
0 4 * * 0 /opt/ssl-cert-system/scripts/deploy-native.sh >> /var/log/ssl-cert-deploy.log 2>&1
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

è„šæœ¬ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼ˆå¯åœ¨è„šæœ¬ä¸­ä¿®æ”¹ï¼‰ï¼š

```bash
# åº”ç”¨é…ç½®
APP_NAME="ssl-cert-system"
APP_DIR="/opt/ssl-cert-system"
SERVICE_NAME="ssl-cert-system"
USER="www-data"
GROUP="www-data"

# å¤‡ä»½é…ç½®
BACKUP_DIR="/opt/backups/ssl-cert-system"
BACKUP_KEEP_DAYS=30

# ç‰ˆæœ¬é…ç½®
GO_VERSION="1.21.13"
NODE_VERSION="18"
```

### ç›®å½•ç»“æ„

```
/opt/ssl-cert-system/          # åº”ç”¨æ ¹ç›®å½•
â”œâ”€â”€ ssl-cert-system            # åº”ç”¨å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ frontend/dist/             # å‰ç«¯æ„å»ºæ–‡ä»¶
â”œâ”€â”€ storage/certs/             # SSLè¯ä¹¦å­˜å‚¨
â”œâ”€â”€ logs/                      # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ .env                       # ç¯å¢ƒé…ç½®
â””â”€â”€ scripts/                   # ç®¡ç†è„šæœ¬

/opt/backups/ssl-cert-system/  # å¤‡ä»½ç›®å½•
â””â”€â”€ YYYYMMDD_HHMMSS/          # æ—¶é—´æˆ³å¤‡ä»½
    â”œâ”€â”€ database.sql.gz        # æ•°æ®åº“å¤‡ä»½
    â”œâ”€â”€ application.tar.gz     # åº”ç”¨æ–‡ä»¶å¤‡ä»½
    â”œâ”€â”€ certificates.tar.gz    # è¯ä¹¦å¤‡ä»½
    â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶å¤‡ä»½
    â””â”€â”€ backup_info.txt        # å¤‡ä»½ä¿¡æ¯
```

## ğŸš¨ æ•…éšœæ’é™¤

### è„šæœ¬æ‰§è¡Œå¤±è´¥

1. **æ£€æŸ¥æƒé™**
```bash
chmod +x scripts/*.sh
```

2. **æ£€æŸ¥ä¾èµ–**
```bash
# æ£€æŸ¥å¿…è¦å‘½ä»¤
which go node npm mysql nginx systemctl
```

3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**
```bash
# ä½¿ç”¨bash -xè¿è¡Œè„šæœ¬æŸ¥çœ‹è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
bash -x ./scripts/deploy-native.sh
```

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
   - éªŒè¯æ•°æ®åº“ç”¨æˆ·æƒé™
   - ç¡®è®¤.envæ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®

2. **åº”ç”¨å¯åŠ¨å¤±è´¥**
   - æŸ¥çœ‹systemdæ—¥å¿—ï¼š`sudo journalctl -u ssl-cert-system -f`
   - æ£€æŸ¥ç«¯å£å ç”¨ï¼š`sudo netstat -tlnp | grep :3001`
   - éªŒè¯åº”ç”¨æ–‡ä»¶æƒé™

3. **Nginxé…ç½®é”™è¯¯**
   - æµ‹è¯•é…ç½®ï¼š`sudo nginx -t`
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
3. å‚è€ƒ [DEPLOYMENT_NATIVE.md](../DEPLOYMENT_NATIVE.md) æ–‡æ¡£
4. åœ¨GitHubä»“åº“æäº¤Issue
